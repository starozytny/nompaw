{% extends 'user/pages/aventures/template.html.twig' %}

{% set groupe = elem.groupe %}
{% set author = elem.author %}

{% set page_title %}{{ elem.name }}{% endset %}
{% set page_subtitle %}Groupe d'aventures : {{ groupe.name }}{% endset %}

{% block breadcrumb %}
    {% set breadcrumbs = breadcrumbs | merge([
        { text: groupe.name, url: path('user_aventures_groupes_read', {'slug': groupe.slug}) },
        { text: page_title_alone, url: path('user_aventures_randos_read', {'slug': elem.slug}) },
    ]) %}
    {{ parent() }}
{% endblock %}

{% set page_actions %}
    {% include 'layout/components/tailwind/buttons/button.html.twig' with {
        btn_link: path('user_aventures_groupes_read', {slug: groupe.slug}),
        btn_type: 'default',
        btn_icon: 'left-arrow',
        btn_text: 'Retourner au groupe'
    } %}
    {% if app.user.id == elem.author.id or app.user.isAdmin %}
        {% include 'layout/components/tailwind/buttons/button.html.twig' with {
            btn_link: path('user_aventures_randos_update', {slug: elem.slug}),
            btn_type: 'default',
            btn_icon: 'pencil',
            btn_text: 'Modifier'
        } %}
    {% endif %}
{% endset %}

{% block main_content %}
<div class="flex flex-col gap-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-1 space-y-4">
            <div class="flex items-center gap-2">
                <div class="bg-amber-50 border border-amber-200 rounded-lg px-4 py-2 inline-flex items-center gap-2">
                    <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
                    <span class="text-sm font-medium text-amber-800">{{ elem.statusString }}</span>
                </div>
                {% if elem.status != 2 %}
                    <div class="w-full flex justify-end gap-1">
                        <div class="delete-rando"
                             data-context="read"
                             data-id="{{ elem.id }}"
                             data-name="{{ elem.name }}"
                             data-groupe-slug="{{ groupe.slug }}"
                        >
                            {% include 'layout/components/tailwind/buttons/button.html.twig' with {
                                btn_link: "",
                                btn_type: 'red',
                                btn_icon: 'chart-3',
                                btn_text: 'Supprimer'
                            } %}
                        </div>
                        {% if elem.startAt != null and elem.adventure != null %}
                            <div class="end-rando"
                                 data-context="read"
                                 data-id="{{ elem.id }}"
                                 data-name="{{ elem.name }}"
                                 data-groupe-slug="{{ groupe.slug }}"
                            >
                                {% include 'layout/components/tailwind/buttons/button.html.twig' with {
                                    btn_link: "",
                                    btn_type: 'green',
                                    btn_icon: 'chart-3',
                                    btn_text: 'Terminer'
                                } %}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>


            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4">
                <h3 class="text-sm font-semibold text-slate-700 mb-3">Participants</h3>
                <div class="flex flex-col gap-3">
                    <div class="flex -space-x-2">
                        {% for member in groupe.links %}
                            {% include "user/layout/components/elements/avatar.html.twig" %}
                        {% endfor %}
                    </div>
                    <div class="text-sm text-slate-600">Référent : {{ author.displayName }}</div>
                </div>
            </div>

            <div class="flex flex-col gap-4 sm:flex-row xl:flex-col">
                <div id="rando_date" class="w-full"
                     data-rando-id="{{ elem.id }}"
                     data-start-at="{{ elem.startAt ? elem.startAt | date('Y-m-d') : "" }}"
                     data-propals="{{ propalDates }}"
                     data-user-id="{{ app.user.id }}"
                     data-author-id="{{ elem.author.id }}"
                     data-mode="{{ app.user.id == elem.author.id or app.user.isAdmin }}"
                     data-status="{{ elem.status }}"
                     data-date-id="{{ elem.adventureDate ? elem.adventureDate.id : "" }}"
                     data-adventure-id="{{ elem.adventure ? elem.adventure.id : "" }}"
                >
                    {% include "layout/components/tailwind/loaders/loader.html.twig" %}
                </div>

                {% if elem.startAt %}
                    <div id="rando_adventures" class="w-full"
                         data-rando-id="{{ elem.id }}"
                         data-user-id="{{ app.user.id }}"
                         data-have-adventure="{{ elem.adventure ? 1 : 0 }}"
                         data-adv-name="{{ elem.adventure ? elem.adventure.name : '' }}"
                         data-propals="{{ propalAdvs }}"
                         data-author-id="{{ elem.author.id }}"
                         data-mode="{{ app.user.id == elem.author.id or app.user.isAdmin }}"
                         data-status="{{ elem.status }}"
                    >
                        {% include "layout/components/tailwind/loaders/loader.html.twig" %}
                    </div>
                {% endif %}
            </div>
        </div>

        {% if elem.startAt and elem.adventure %}
            <div class="lg:col-span-2 space-y-6">
                {% set adventure = elem.adventure %}

                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                        <h2 class="text-xl font-bold text-white">{{ adventure.name }}</h2>
                        <p class="text-indigo-100 text-sm mt-1">{{ elem.startAt ? elem.startAt | format_datetime('full', 'none', locale='fr') | capitalize : 'Date indéfinie' }}</p>
                    </div>

                    <div class="p-6 space-y-4">
                        {% if elem.description %}
                            <div class="text-slate-600 italic">
                                {{ elem.description | raw }}
                            </div>
                        {% endif %}

                        <div class="grid grid-cols-2 gap-4 pt-4 border-t border-slate-100 xl:grid-cols-3 2xl:grid-cols-4">
                            {% if elem.localisation %}
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-color0/10 rounded-lg flex items-center justify-center">
                                        <span class="icon-placeholder text-color0"></span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">Lieu</p>
                                        <p class="text-sm font-medium text-slate-900">{{ elem.localisation }}</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if elem.distance %}
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center">
                                        <span class="icon-map text-emerald-600"></span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">Distance</p>
                                        <p class="text-sm font-medium text-slate-900">{{ elem.distance }} km</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if elem.devPlus %}
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                        <span class="icon-placeholder text-red-600"></span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">D+</p>
                                        <p class="text-sm font-medium text-slate-900">{{ elem.devPlus }} m</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if elem.altitude %}
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
                                        <span class="icon-placeholder text-amber-600"></span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">Altitude</p>
                                        <p class="text-sm font-medium text-slate-900">{{ elem.altitude }} m</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if elem.story %}
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <span class="icon-book-1 text-blue-600"></span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">Histoire</p>
                                        <div class="text-sm font-medium">
                                            <a href="{{ path('user_homepage') ~ "blog/" ~ elem.story }}" class="text-blue-700 hover:text-blue-500 hover:underline" target="_blank">Lien vers l'histoire</a>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}

                            {% if adventure.url and adventure.url != "https://" %}
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <span class="icon-book-1 text-gray-600"></span>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">Topo</p>
                                        <div class="text-sm font-medium">
                                            <a href="{{ adventure.url }}" class="text-blue-700 hover:text-blue-500 hover:underline" target="_blank">Lien du topo</a>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>

                        {% if app.user.id == elem.author.id or app.user.isAdmin %}
                            <a class="group flex items-center gap-2 cursor-pointer" href="{{ path('user_aventures_randos_update', {slug: elem.slug}) }}">
                                <span class="icon-add text-blue-900"></span>
                                <span class="text-sm font-medium text-blue-900 group-hover:underline">Ajouter des informations</span>
                            </a>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
    </div>

    <div id="rando_images" class="xl:col-span-3"
         data-rando-id="{{ elem.id }}"
         data-user-id="{{ app.user.id }}"
         data-images="{{ images }}"
    >
        {% include "layout/components/tailwind/loaders/loader.html.twig" %}
    </div>
</div>
{% endblock %}
